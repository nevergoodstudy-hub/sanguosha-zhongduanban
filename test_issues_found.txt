==============================================================================
  三国杀终端版 - 测试问题报告
  生成日期: 2026-02-09
  测试环境: Python 3.14.2 / pytest 9.0.2 / Windows
==============================================================================

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  本轮测试中发现并修复的问题
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ISSUE-001: test_guose 不确定性测试失败
  文件: tests/test_skills.py:1280
  原因: handle_guose 需要方块牌和有效目标，测试未提供确定性输入，
        依赖随机发牌结果
  修复: 显式提供方块牌 (CardSuit.DIAMOND) 和目标，使用确定性参数调用
  状态: ✅ 已修复

ISSUE-002: test_request_sha_no_cards 不确定性测试失败
  文件: tests/test_subsystems.py:106
  原因: 当玩家持有龙胆(longdan)技能时，闪可被当杀打出，
        导致 request_sha 返回 1 而非 0
  修复: 测试前清除玩家所有英雄技能，确保无转换技能干扰
  状态: ✅ 已修复

ISSUE-003: test_duanliang 不确定性测试失败
  文件: tests/test_skills.py:1313
  原因: handle_duanliang 需要黑色基本/装备牌和距离≤2的有效目标，
        测试未提供确定性输入
  修复: 显式提供黑色基本牌 (CardSuit.CLUB) 和目标，使用确定性参数调用
  状态: ✅ 已修复

ISSUE-004: test_qixi 潜在不确定性
  文件: tests/test_skills.py:1306
  原因: handle_qixi 需要黑色牌和有卡牌可拆的目标，依赖随机状态
  修复: 显式提供黑色牌和目标手牌，使用确定性参数调用
  状态: ✅ 已修复

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  已知但未修复的问题 (低优先级/设计约束)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ISSUE-005: Ruff 静态分析残留警告 (1219 条)
  主要类别:
    - D415 missing-terminal-punctuation: 884 条 (docstring 缺少句号)
    - D102 undocumented-public-method: 184 条
    - D205 missing-blank-line-after-summary: 42 条
    - SIM102 collapsible-if: 32 条
    - F841 unused-variable: 28 条
  影响: 代码风格/文档规范问题，不影响功能
  建议: 渐进修复，优先处理 F841 未使用变量

ISSUE-006: game_controller.py 覆盖率仅 47%
  文件: game/game_controller.py
  原因: 该模块是 UI 交互控制器，大量方法依赖 Textual UI 运行环境，
        无法在纯单元测试中覆盖
  建议: 引入 Textual Pilot 集成测试覆盖关键路径

ISSUE-007: skill_interpreter.py 覆盖率仅 48%
  文件: game/skill_interpreter.py
  原因: DSL 解释器部分执行路径依赖复杂游戏状态组合
  建议: 添加更多 DSL 定义文件和对应的解释器测试用例

ISSUE-008: net/client.py 覆盖率仅 40%
  文件: net/client.py
  原因: 网络客户端需要真实 WebSocket 连接，单元测试使用 mock 覆盖有限
  建议: 添加集成测试或使用 asyncio test server 进行端对端测试

ISSUE-009: normal_strategy.py 覆盖率仅 57%
  文件: ai/normal_strategy.py
  原因: AI 策略包含大量条件分支，部分罕见场景未被触发
  建议: 增加针对特定游戏状态的参数化测试

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  上一轮 BUG-001~008 修复验证结果
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

BUG-001 (shensu 测试闪避): ✅ 验证通过
BUG-002 (CSS 动画类缺失): ✅ 验证通过
BUG-003 (覆盖率配置):     ✅ 验证通过 - 覆盖率 75.71% > 60% 阈值
BUG-004 (静态分析):       ✅ 验证通过 - F821 undefined name 为 0
BUG-005 (类型安全):       ✅ 验证通过
BUG-006 (依赖同步):       ✅ 验证通过
BUG-007 (ganglie UI 路由): ✅ 验证通过
BUG-008 (guicai UI 路由):  ✅ 验证通过
